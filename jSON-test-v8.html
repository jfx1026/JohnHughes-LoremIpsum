<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>title</title>

  	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

  </head>

  <body>
    
    <h1>Testing JSON data flow</h1>
    
    <script>

      var globalJsonVar; // create global variable for JSON data
      
      // random starting point variables
      var randomStart = 0; // initialize the randomStart variable
      var tempLimit = 0;
      var movieIndex = 0; // indexByName(movieSelect) - an attempt to make this more dynamic
      var stringData = new Array(); // create array for lines
      console.log ("stringData = " + stringData);

      // user variables
      var movieSelect = "Pretty In Pink"; // using this movie for testing
      var unitSelect = "sentences"; // usuing this for testing - could be paragraphs or lines
      var numberSelect = 10; // using 2 for testing
      var lineCount = 0; // how many lines in the movie selected

      function indexByName() { //translate names to index values - para was 'movieName'
        if (movieSelect == "Pretty In Pink") {
          movieIndex = 0;
        } else if (movieSelect == "Ferris Buelluer's Day Off") {
          movieIndex = 1;
        }
      } 
        
      function liveDataTest() { // function to test the live data 
            
        // temp variables for testing
        var prefix = "Movie ";
        var suffix = "!!! <br/>";
        
        for (var i = 0; i < globalJsonVar.length; i++) {
          document.write(prefix + i + ": " + globalJsonVar[i].movie + suffix);
        }
        
        console.log(globalJsonVar); // spit out data to console
      }
      
      function actualDataTest() { // an attempt to write data based on user vars
        for (var x = randomStart; x < (numberSelect + randomStart); x++) {
          var tempData = globalJsonVar[movieIndex].paragraphs[x];
          console.log ("x = " + x); // testing random variable
          tempData = tempData.join(" "); // remove the commas from the output
          document.write("<br/>" + tempData + "<br/>");
        }
      }
        
      function writeSentences() { // write sentences instead of paragrapghs
        lineCounter(); // start line counter for sentences - this should be smarter        

        var lineCounterResult = 0; // count the number of lines read
        tempData = ""; // reset tempData var
        
        console.log("Checking lineCounter value = " + lineCounterResult);
        for (var x = randomStart; x < (numberSelect + lineCount); x++) {
          console.log("lineCounterResult = " + lineCount);
          
          for (var z = 0 ; z < globalJsonVar[movieIndex].paragraphs[z].length; z++) { // begin loop on first selected paragraph
            if (lineCounterResult < numberSelect) {
              var tempData = (globalJsonVar[movieIndex].paragraphs[randomStart][z] + " ");  // grab the first line from the randomStart paragraph
              console.log("Testing tempData = " + tempData); // this seems to grab the lines - but something is off
              lineCounterResult++;
              console.log("Is this even working? lineCounterResult = " + lineCounterResult);
              
              stringData.push(tempData); // add new string to array
            }
          }
          //console.log ("x = " + x); // testing random variable
          stringData = stringData.join(" "); // remove the commas from the output    
          document.write(stringData + " ");
        }
      }  
        
/* FROM GONEN
      Function getXLinesStartingAtParagraphY(numberOfLines, firstParagraphIndex)
      outputLineCounter = 0
      outputLines = â€œ"
      current_paragraph_index = firstParagraphIndex
      While(outputLineCounter < numberOfLines) 
      currentParagraph = paragraphs[current_paragraph_index]
      lineInParagraph  = 0
      While(lineInParagraph < length(currentParagraph)  
*/
        
      function grabJSON() { // function to grab the JSON and create the array
        $.getJSON("movie-text.json", function(json) {
          globalJsonVar = json; // this creates the json data object inside the globalJsonVar
          liveDataTest(); // trigger something to write the data
          getRange(); //get a random number to start at within a range
        });
      }
      
      function getRange() { //create a random starting point, based on movie, type and number of units requested
        if (unitSelect == "paragraphs") {
          tempLimit = globalJsonVar[movieIndex].paragraphs.length; // I need the length or number of paragraphs in the movie selected
        } else if (unitSelect == "sentences") {
          tempLimit = lineCount; // I need the length or number of sentences in the movie selected
        }
        
        //Math.random() * (max - min) + min; - random number between two values
        randomStart = Math.floor((Math.random() * (tempLimit - 0))); // generate random number between 0 and max units
        console.log ("tempLimit = " + tempLimit);
        console.log ("randomStart = " + randomStart);
        console.log ("movieIndex = " + movieIndex);
        writeSentences(); // testing actual data to page
      }
      
      function lineCounter() { // count how mnay lines are in the selected movie
        for (var count = 0; count < tempLimit; count++) {
          lineCount = lineCount + globalJsonVar[movieIndex].paragraphs[count].length;
        }
        console.log("lineCount = " + lineCount); // write number of lines in the selected movie
      }
      
      </script>
    
    <p id="demo">Something should go here and replace this.</p>

    <script>
      grabJSON(); // get the data
      indexByName(); // create index number based on name
    </script>
        
  </body>
</html>